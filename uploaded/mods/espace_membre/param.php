<?php/*Copyright CrazyCMS : Valmori Quentin	quentin.valmori@gmail.comFeuvre Christophe	neowan@live.frHaustrate Kevin	gippel5@hotmail.comThis software is a computer program whose purpose is to make our own website. You just have to follow the automatic installation procedureand you website is operational. Moreover, He is securized and optimized as much as possible.This software is governed by the CeCILL² license under French law andabiding by the rules of distribution of free software.  You can  use, modify and/ or redistribute the software under the terms of the CeCILL²license as circulated by CEA, CNRS and INRIA at the following URL"http://www.cecill.info". The fact that you are presently reading this means that you have hadknowledge of the CeCILL² license and that you accept its terms.*/if(!defined('CCMS'))die('' );if($grade >0){	$template->set_filename ( 'haut_mods.tpl' );	$template->assign_block_vars ( 'mod_titre' , array ( 'TITRE' => parameters ) );	$template->set_filename ( './modules/espace_membre/links.tpl' );	$template->assign_block_vars ( 'links' , array (	'UID' => $uid,	'PWD' => $user_password,	'UNLOG' => unlog,	'MY_BLOC_NOTE' => my_bloc_note,	'MODIF_PROFIL' => modif_profil,	'CHANGE_LANGUAGE' => change_language,	'CHANGE_THEME' => change_theme,	'MY_INFOS' => my_infos,	'MY_CONFIG' => my_config ) );		$template->set_filename ( './modules/espace_membre/param.tpl' );		//Si le formulaire est validé	if(isset($_GET['valid'])){		$fuso = htmlspecialchars($_POST['fuso'],ENT_QUOTES);		if ( $fuso < -12 ) $fuso = -12;		if ( $fuso > 14 ) $fuso = 14;				$Bdd->sql('UPDATE  '.PT.'_users SET fuseaux="'.$fuso.';'.( ( isset ( $_POST['correction'] ) ) ? ('1') : ('0') ).'" WHERE id="'.$uid.'"' );			$template->assign_block_vars ( 'text' , array (		'TXT' => modif_success,		'URL' => './index.php?mods=espace_membre&page=param',		'BACK' => back ) );			}	else if ( isset ( $_POST['first'] ) ){			$new_syntaxe = '';				switch ( $_POST['first'] ){					case 'd':				$new_syntaxe .= 'd';			break;			case 'm':				$new_syntaxe .= 'm';			break;			case 'y':				$new_syntaxe .= 'y';			break;					}		switch ( $_POST['sep_first'] ){					case '-':				$new_syntaxe .= '-';			break;			case '|':				$new_syntaxe .= '|';			break;			case '\\':				$new_syntaxe .= '\\';			break;			case '/':				$new_syntaxe .= '/';			break;			case ':':				$new_syntaxe .= ':';			break;			case ';':				$new_syntaxe .= ';';			break;					}				switch ( $_POST['second'] ){					case 'd':				$new_syntaxe .= 'd';			break;			case 'm':				$new_syntaxe .= 'm';			break;			case 'y':				$new_syntaxe .= 'y';			break;					}				switch ( $_POST['sep_second'] ){					case '-':				$new_syntaxe .= '-';			break;			case '|':				$new_syntaxe .= '|';			break;			case '\\':				$new_syntaxe .= '\\';			break;			case '/':				$new_syntaxe .= '/';			break;			case ':':				$new_syntaxe .= ':';			break;			case ';':				$new_syntaxe .= ';';			break;					}				switch ( $_POST['third'] ){					case 'd':				$new_syntaxe .= 'd';			break;			case 'm':				$new_syntaxe .= 'm';			break;			case 'y':				$new_syntaxe .= 'y';			break;					}				$new_syntaxe .= ' '.str_replace ( ' ' , '+esp;' , htmlspecialchars ( $_POST['center_text'] ) ).' ';				switch ( $_POST['type'] ){						case 12:				$new_syntaxe .= '12';			break;			case 24:				$new_syntaxe .= '24';			break;				}				switch ( $_POST['sep_last'] ){					case '-':				$new_syntaxe .= '-';			break;			case '|':				$new_syntaxe .= '|';			break;			case '\\':				$new_syntaxe .= '\\';			break;			case '/':				$new_syntaxe .= '/';			break;			case ':':				$new_syntaxe .= ':';			break;			case ';':				$new_syntaxe .= ';';			break;					}				$Bdd->sql ( 'UPDATE '.PT.'_users SET format_date="'.$new_syntaxe.'" WHERE id="'.$uid.'"' );				$template->assign_block_vars ( 'text' , array (		'TXT' => updated_successfully,		'URL' => './index.php?mods=espace_membre&page=param',		'BACK' => back ) );			}	else if ( isset ( $_POST['appear_offline'] ) ){		$appear_offline = intval ( $_POST['appear_offline'] );		$msn = intval ( $_POST['msn'] );		$email = intval ( $_POST['email'] );		$icq = intval ( $_POST['icq'] );		$yahoom = intval ( $_POST['yahoom'] );		$aim = intval ( $_POST['aim'] );		$birth = intval ( $_POST['birth'] );		$localisation = intval ( $_POST['localisation'] );		$u_privacy = $email.','.$msn.','.$icq.','.$yahoom.','.$aim.','.$birth.','.$localisation ;				$template->assign_block_vars ( 'text' , array (		'TXT' => modif_success,		'URL' => './index.php?mods=espace_membre&page=param',		'BACK' => back ) );				$Bdd->sql('UPDATE  '.PT.'_users SET privacy="'.$u_privacy.'", appear_offline="'.$appear_offline.'" WHERE id="'.$uid.'"' );	}	else{		$format = explode ( ' ' , $format_date );				$template->assign_block_vars ( 'index' , array (			'TIME_SONE' => time_sone,			'DATE_SYNTAX' => DATE_SYNTAX,			'SEPARATOR' => SEPARATOR,			'DATE_HOUR' => DATE_HOUR,			'DATE_TYPE' => DATE_TYPE,			'HOUR_SEPARATOR' => HOUR_SEPARATOR,			'DAY' => DAY,			'MONTH' => MONTH,			'YEAR' => YEAR,			'CENTER_SEP' => str_replace ( '+esp;' , ' ' , $format[1] ),			'VALID' => valid,			'PB_HOURS' => pb_hours,			'JS' => '			<script type="text/javascript">				<!--					function change(){						var hour = document.getElementById(\'general\').innerHTML.split(":");						var heure = Math.round(hour[0]) + Math.round(document.getElementById(\'fuso\').value) + Math.round(document.getElementById(\'winter\').checked);						if(heure > 24){							var heure = Math.round(heure) - Math.round(24);						}						else if(heure<0){							var heure = Math.round(24) + Math.round(heure);						}						document.getElementById(\'actual\').innerHTML = heure + " : " + hour[1];					}				-->			</script>',			'CURRENT_HOUR' => current_hour,			'WE_ARE_ON' => WE_ARE_ON,			'TIME' => ccmsdate($fuseaux,convertime(time())),			'GM_TIME' => gmdate('H\:i',time()),			'CHECKED' => ( ( $fuseaux_user_2 [ 1 ] == 1 ) ? ('checked="checked"') : ('') ),			'F1' => ( ( $format_date{0} == 'd' ) ? ('selected="selected"') : ('') ),			'F2' => ( ( $format_date{0} == 'm' ) ? ('selected="selected"') : ('') ),			'F3' => ( ( $format_date{0} == 'y' ) ? ('selected="selected"') : ('') ),			'S1' => ( ( $format_date{1} == '/' ) ? ('selected="selected"') : ('') ),			'S2' => ( ( $format_date{1} == '-' ) ? ('selected="selected"') : ('') ),			'S3' => ( ( $format_date{1} == '|' ) ? ('selected="selected"') : ('') ),			'S4' => ( ( $format_date{1} == '\\' ) ? ('selected="selected"') : ('') ),			'S5' => ( ( $format_date{1} == ':' ) ? ('selected="selected"') : ('') ),			'S6' => ( ( $format_date{1} == ';' ) ? ('selected="selected"') : ('') ),			'SE1' => ( ( $format_date{2} == 'd' ) ? ('selected="selected"') : ('') ),			'SE2' => ( ( $format_date{2} == 'm' ) ? ('selected="selected"') : ('') ),			'SE3' => ( ( $format_date{2} == 'y' ) ? ('selected="selected"') : ('') ),			'SS1' => ( ( $format_date{3} == '/' ) ? ('selected="selected"') : ('') ),			'SS2' => ( ( $format_date{3} == '-' ) ? ('selected="selected"') : ('') ),			'SS3' => ( ( $format_date{3} == '|' ) ? ('selected="selected"') : ('') ),			'SS4' => ( ( $format_date{3} == '\\' ) ? ('selected="selected"') : ('') ),			'SS5' => ( ( $format_date{3} == ':' ) ? ('selected="selected"') : ('') ),			'SS6' => ( ( $format_date{3} == ';' ) ? ('selected="selected"') : ('') ),			'T1' => ( ( $format_date{4} == 'd' ) ? ('selected="selected"') : ('') ),			'T2' => ( ( $format_date{4} == 'm' ) ? ('selected="selected"') : ('') ),			'T3' => ( ( $format_date{4} == 'y' ) ? ('selected="selected"') : ('') ),			'TT1' => ( ( substr ( $format_date , ( strlen ( $format_date ) - 4 ) , ( strlen ( $format_date ) - 2 ) ) == 24 )? ('selected="selected"') : ('') ),			'TT2' => ( ( substr ( $format_date , ( strlen ( $format_date ) - 4 ) , ( strlen ( $format_date ) - 2 ) ) == 12 )? ('selected="selected"') : ('') ),			'L1' => ( ( $format_date{strlen ( $format_date ) -1 } == '/' ) ? ('selected="selected"') : ('') ),			'L2' => ( ( $format_date{strlen ( $format_date ) -1 } == '-' ) ? ('selected="selected"') : ('') ),			'L3' => ( ( $format_date{strlen ( $format_date ) -1 } == '|' ) ? ('selected="selected"') : ('') ),			'L4' => ( ( $format_date{strlen ( $format_date ) -1 } == '\\' ) ? ('selected="selected"') : ('') ),			'L5' => ( ( $format_date{strlen ( $format_date ) -1 } == ':' ) ? ('selected="selected"') : ('') ),			'L6' => ( ( $format_date{strlen ( $format_date ) -1} == ';' ) ? ('selected="selected"') : ('') ),			'PARAMS' => PARAMS,			'APPEAR_OFFLINE' => APPEAR_OFFLINE,			'AO_CHECKED' => ( ( $appear_offline == 0 ) ? ('checked="true"') : ('') ),			'AO_CHECKED1' => ( ( $appear_offline == 1 ) ? ('checked="true"') : ('') ),			'YES' => YES,			'NO' => NO,			'HIDE_INFOS' => HIDE_PERSONNAL_INFOS,			'EMAIL' => EMAIL_ADRESS,			'E_CHECKED' => ( ( $u_privacy{0} == 0 ) ? ('checked="true"') : ('') ),			'E_CHECKED1' => ( ( $u_privacy{0} == 1 ) ? ('checked="true"') : ('') ),			'MSN' => MSN_ADRESS,			'MSN_CHECKED' => ( ( $u_privacy{2} == 0 ) ? ('checked="true"') : ('') ),			'MSN_CHECKED1' => ( ( $u_privacy{2} == 1 ) ? ('checked="true"') : ('') ),			'ICQ' => ICQ_ADRESS,			'ICQ_CHECKED' => ( ( $u_privacy{4} == 0 ) ? ('checked="true"') : ('') ),			'ICQ_CHECKED1' => ( ( $u_privacy{4} == 1 ) ? ('checked="true"') : ('') ),			'YAHOOM' => YAHOOM_ADRESS,			'YAHOOM_CHECKED' => ( ( $u_privacy{6} == 0 ) ? ('checked="true"') : ('') ),			'YAHOOM_CHECKED1' => ( ( $u_privacy{6} == 1 ) ? ('checked="true"') : ('') ),			'AIM' => AIM_ADRESS,			'AIM_CHECKED' => ( ( $u_privacy{8} == 0 ) ? ('checked="true"') : ('') ),			'AIM_CHECKED1' => ( ( $u_privacy{8} == 1 ) ? ('checked="true"') : ('') ),			'BIRTHDAY' => BIRTHDAY_DATE,			'BIRTHDAY_CHECKED' => ( ( $u_privacy{10} == 0 ) ? ('checked="true"') : ('') ),			'BIRTHDAY_CHECKED1' => ( ( $u_privacy{10} == 1 ) ? ('checked="true"') : ('') ),			'LOCALISATION' => LOCALISATION,			'LOCA_CHECKED' => ( ( $u_privacy{12} == 0 ) ? ('checked="true"') : ('') ),			'LOCA_CHECKED1' => ( ( $u_privacy{12} == 1 ) ? ('checked="true"') : ('') ),			'PRINT' => PPRINT,			'HIDE' => HIDE ) );		//Boucle pour afficher les différents fuseaux!		for($i=-12;$i<14;$i++){			if($i != $fuseaux_user_2 [ 0 ]){					$template->assign_block_vars ( 'index.fuseau' , array (					'I' => $i,					'SELECTED' => '' ) );			}			else{				$template->assign_block_vars ( 'index.fuseau' , array (				'I' => $i,				'SELECTED' => 'selected="selected"' ) );			}		}	}	$template->set_filename ( 'bas_mods.tpl' );}else{	// Si l'utilisateur n'a rien a faire la, on lui dit ;)	$template->set_filename('error_page.tpl' );	$template->assign_vars ( array ( 'ACCESS_UNAUTHORIZED' => ACCESS_UNAUTHORIZED ) );}?>