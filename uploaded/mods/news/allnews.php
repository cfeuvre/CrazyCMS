<?php/*Copyright CrazyCMS : Valmori Quentin	quentin.valmori@gmail.comFeuvre Christophe	neowan@live.frHaustrate Kevin	gippel5@hotmail.comThis software is a computer program whose purpose is to make our own website. You just have to follow the automatic installation procedureand you website is operational. Moreover, He is securized and optimized as much as possible.This software is governed by the CeCILL² license under French law andabiding by the rules of distribution of free software.  You can  use, modify and/ or redistribute the software under the terms of the CeCILL²license as circulated by CEA, CNRS and INRIA at the following URL"http://www.cecill.info". The fact that you are presently reading this means that you have hadknowledge of the CeCILL² license and that you accept its terms.*/if(!defined('CCMS'))die('' );$template->set_filename ( 'haut_mods.tpl' );$template->set_filename ( './modules/news/allnews.tpl' );$template->assign_block_vars ( 'mod_titre' , array ( 'TITRE' => all_news ) );//Si le visiteur est un membre ou + on selectionne les news qu'il a le droit de voir!//J'avoue la requette semble peu lisible mais elle est si compréhensible ;)!//Voila la requete est bcp plus visible comme ca :P$sql = $Bdd->get_cached_data('SELECT  n.id AS idnews,								n.titre AS titrenews,								n.date AS datenews,								n.publication AS publicationnews,								n.auteur AS auteurnews,								n.parent AS parentnews,								n.contenu AS contenunews,								n.hit AS hitnews,								n.smileys AS smileysnews,								n.groupes AS groupesnews,								n.comments AS commentsnews,								n.add_coment AS add_comentnews,								u.id AS idusers,								u.pseudo AS pseudomembre,								u.groupe AS groupemembre					FROM '.PT.'_news AS n					LEFT JOIN '.PT.'_users AS u					ON ( u.id = n.auteur)					WHERE n.valid=1					GROUP BY n.id					ORDER BY n.id DESC',3600,'news' );//on compte le nb de selection, si c'est strictement supérieur a 0 alors c'est qu'il y a des newsif($Bdd->num_rows($sql)>0) {	//On défini la varaible du cache$contenu_mod='';	//On traite les données	foreach ( $sql AS $id=>$qrep )	{		// Si la date de publication est dépassé, on affiche la news ;)		if( $qrep['publicationnews'] <= convertime ( time() ) ){			$verif =1;			//Recuperation titre			$titre = to_html ( $qrep['titrenews'] );			$perm = false;			if($qrep['groupesnews'] ==''){				$perm = true;			}			else{				//On regarde si le gorupe du membre est le même que celui de la news, ou si la news est visible par tout le monde				$news_groupe = explode(';',$qrep['groupesnews']);				foreach ( $news_groupe as $news_see ){					if(ereg($news_see.";",$groupe)){						$perm = true;					}				}			}			//Si l'utilisateur a le droit de voir la news, on lui affiche ;)			if($perm===true){				//C'est parti on affiche tout ca :D!				$template->assign_block_vars ( 'liste' , array (				'ID' => $qrep['idnews'],				'TITRE' => $titre ) );			}		}	}	}else{	//Si le nombre de sélection est de 0, alors il y a pas de news pour le membre donc on lui dit^^	$template->assign_block_vars ( 'none' , array ( 'TXT' => nobody_news ) );}$template->set_filename ( 'bas_mods.tpl' );?>